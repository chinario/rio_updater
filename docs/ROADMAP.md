# 🗺️ CNB 集成开发路线图

**制定日期**: 2026-01-11  
**预期完成**: 2026-02-10  
**总周期**: 4 周

---

## 📅 周级计划

### Week 1: 准备与验证 (1月11-17)

#### 1月11 (T+0) - 今天

```
09:00-10:00  ✅ 正式化 DEVELOPMENT_PLAN
             ├─ 合并补充信息
             ├─ 整理成单一文档
             └─ 确认 API 基础 URL

10:00-10:30  ✅ 验证 API 可用性
             ├─ 执行 curl 命令
             ├─ 记录响应格式
             └─ 生成 API_VERIFICATION.md

10:30-11:00  ✅ 确认 Receipt 规范
             ├─ 分析 GitHub 格式
             ├─ 设计 CNB 格式
             └─ 输出 RECEIPT_SPECIFICATION.md

11:00-12:00  ✅ 创建配置文档
             ├─ 整理 Cargo.toml 依赖
             ├─ 确认测试环境
             └─ 验证 Python 脚本

预期产出:
  ✅ 正式版 DEVELOPMENT_PLAN.md
  ✅ API_VERIFICATION.md
  ✅ RECEIPT_SPECIFICATION.md
  ✅ CARGO_DEPENDENCIES.md
```

#### 1月12-13 (T+1-2) - 周末完成

```
第二天 (1月12)

09:00-10:00  📝 提取 API 端点清单
             ├─ 解析 cnb_doc.json
             ├─ 列出 12 个 Release API
             ├─ 记录端点路径
             └─ 输出 CNB_API_ENDPOINTS.md

10:00-11:00  🧪 编写测试脚本
             ├─ 创建 scripts/test_cnb.sh
             ├─ 创建 scripts/verify_cnb_api.py
             ├─ 验证脚本可运行
             └─ 测试覆盖各端点

11:00-12:00  📋 定义成功标准
             ├─ 功能标准 (8 项)
             ├─ 性能标准 (4 项)
             ├─ 安全标准 (4 项)
             └─ 输出 ACCEPTANCE_CRITERIA.md

预期产出:
  ✅ CNB_API_ENDPOINTS.md
  ✅ scripts/test_cnb.sh
  ✅ scripts/verify_cnb_api.py
  ✅ ACCEPTANCE_CRITERIA.md
```

#### 1月14-17 (T+3-6) - 周中补充

```
设计评审会议 (1月14)
├─ 回顾 API 设计
├─ 确认 Receipt 字段
├─ 敲定超时重试策略
└─ 签字确认

架构设计完成 (1月15-16)
├─ 绘制模块依赖图
├─ 设计数据结构
├─ 设计错误类型
└─ 输出 CNB_ARCHITECTURE.md

最终检查 (1月17)
├─ 验证所有配置文件
├─ 验证环境变量模板
├─ 验证测试脚本
└─ 签字确认开始开发
```

---

### Week 2-3: 核心开发 (1月18-31)

#### Phase 2.1 - CnbClient 实现 (1月18-22)

```
1月18 (T+7) - 模块框架
  ├─ 创建 axoupdater/src/release/cnb.rs
  ├─ 定义 CnbClient 结构
  ├─ 定义数据结构 (CnbRelease, CnbAsset)
  └─ 实现基础框架 (500 行)

1月19-20 - API 方法实现
  ├─ 实现 fetch_latest_release()
  ├─ 实现 fetch_release_by_tag()
  ├─ 实现 fetch_release_by_id()
  ├─ 实现 fetch_asset()
  └─ 完成 1500 行代码

1月21 - 错误处理
  ├─ 定义 CnbError enum
  ├─ 实现错误映射
  ├─ 实现重试逻辑
  └─ 完成 300 行代码

1月22 - 测试与调试
  ├─ 单元测试编写
  ├─ 集成测试编写
  ├─ 性能测试 (API 响应时间)
  └─ 覆盖率验证 > 80%

预期代码: ~2300 行
```

#### Phase 2.2 - Release 源集成 (1月23-27)

```
1月23 - 框架集成
  ├─ 修改 axoupdater/src/release/mod.rs
  ├─ 添加 ReleaseSourceType::CNB
  ├─ 添加 mod cnb 引用
  └─ 完成 50 行代码

1月24-25 - 获取逻辑实现
  ├─ 在 AxoUpdater 中添加 CNB 分支
  ├─ 实现 fetch_cnb_release()
  ├─ 实现版本比对逻辑
  └─ 完成 200 行代码

1月26 - Token 管理
  ├─ 扩展 AuthorizationTokens
  ├─ 实现 set_cnb_token()
  ├─ 实现环境变量读取
  └─ 完成 100 行代码

1月27 - 集成测试
  ├─ 端到端测试
  ├─ 与 GitHub 源对比测试
  ├─ 错误场景测试
  └─ 回归测试

预期代码: ~350 行
预期总计: ~2650 行新代码
```

#### Phase 2.3 - 配置与文档 (1月28-31)

```
1月28 - 配置更新
  ├─ 更新 Cargo.toml 依赖
  ├─ 添加 cnb_releases 特性
  ├─ 更新 Cargo.lock
  └─ 验证编译通过

1月29-30 - 文档编写
  ├─ 更新 README.md (CNB 部分)
  ├─ 编写 docs/CNB_USAGE.md
  ├─ 编写 docs/CNB_DEVELOPMENT.md
  ├─ 生成 rustdoc
  └─ 验证文档链接

1月31 - 最终检查
  ├─ cargo fmt 检查
  ├─ cargo clippy 检查
  ├─ cargo audit 检查
  ├─ 测试覆盖率验证 > 80%
  └─ 代码审查准备
```

---

### Week 4: 测试与发布 (2月1-10)

#### Phase 3 - 完整测试 (2月1-5)

```
2月1-2 - 单元测试扩展
  ├─ 增加边界情况测试
  ├─ 增加错误场景测试
  ├─ 目标覆盖率 > 90%
  └─ 生成覆盖率报告

2月3-4 - 集成测试验证
  ├─ 真实 API 调用测试
  ├─ 版本升级完整流程
  ├─ 多平台资源测试
  └─ 性能基准测试

2月5 - 兼容性测试
  ├─ 与 GitHub 源兼容
  ├─ 与 Axo 源兼容
  ├─ 向后兼容性检查
  └─ 签字确认通过
```

#### Phase 4 - 版本发布 (2月6-10)

```
2月6 - 发布准备
  ├─ 更新 CHANGELOG.md
  ├─ 确认版本号
  ├─ 最终代码审查
  └─ 签字批准发布

2月7-8 - 本地验证
  ├─ 本地编译 (all-features)
  ├─ 本地完整测试
  ├─ 文档生成验证
  ├─ 性能测试验证
  └─ 安全审查通过

2月9 - 发布执行
  ├─ 更新版本号到 Cargo.toml
  ├─ 创建 git tag
  ├─ 运行 cargo publish
  ├─ 创建 GitHub release
  └─ 发布成功通知

2月10 - 发布验证
  ├─ 验证 crates.io 可用
  ├─ 验证 docs.rs 文档生成
  ├─ 验证用户可安装
  └─ 完成！🎉
```

---

## 📊 工时统计

| 阶段 | 任务 | 工时 | 预期 |
|------|------|------|------|
| Week 1 | 准备验证 | 20h | 5d × 4h |
| Week 2-3 | 核心开发 | 40h | 10d × 4h |
| Week 4 | 测试发布 | 20h | 5d × 4h |
| **总计** | **4 周** | **80h** | **20 个工作日** |

---

## 🎯 关键里程碑

```
2026-01-11 (T+0) ──→ 开发规划完成，准备就绪
2026-01-18 (T+7) ──→ 核心代码实现开始
2026-01-25 (T+14) ─→ CnbClient 初版完成
2026-02-01 (T+21) ─→ 集成测试通过
2026-02-07 (T+27) ─→ 代码冻结，进入发布流程
2026-02-10 (T+30) ─→ 版本正式发布 ✅
```

---

## ✅ 检查点清单

每个关键日期的验证清单：

### ✅ 1月11 晚间检查点
- [ ] 所有 P0 文档已创建
- [ ] API 可用性已验证
- [ ] Receipt 规范已确认
- [ ] 团队确认开始日期

### ✅ 1月17 评审检查点
- [ ] P1 所有文档已完成
- [ ] 架构设计已批准
- [ ] 环境完全准备好
- [ ] 团队讨论通过开发方案

### ✅ 1月24 进度检查点
- [ ] CnbClient 基础框架完成
- [ ] 核心 API 方法 50% 完成
- [ ] 单元测试框架就绪

### ✅ 1月31 中期检查点
- [ ] CnbClient 100% 完成
- [ ] Release 集成 100% 完成
- [ ] 错误处理完整
- [ ] 单元测试覆盖率 > 80%

### ✅ 2月5 最终检查点
- [ ] 集成测试全部通过
- [ ] 性能指标达成
- [ ] 兼容性验证通过
- [ ] 代码审查通过

### ✅ 2月10 发布检查点
- [ ] 版本已发布
- [ ] 文档已生成
- [ ] GitHub release 已创建
- [ ] 用户验收确认

---

## 🚨 风险与应对

| 风险 | 概率 | 影响 | 应对 |
|------|------|------|------|
| API 变更 | 低 | 中 | 提前 1 周联系 CNB 方 |
| Token 失效 | 中 | 高 | 准备备用 token |
| 依赖冲突 | 低 | 中 | 提前 1 周测试依赖 |
| 测试环境问题 | 中 | 中 | 使用 Docker 隔离 |
| 进度滞后 | 低 | 高 | 周三评审，及时调整 |

---

## 📞 沟通计划

| 日期 | 类型 | 参与人 | 议题 |
|------|------|--------|------|
| 1月14 | 设计评审 | 开发 + 产品 | 设计确认 |
| 1月21 | 进度同步 | 开发 | 进度 50% |
| 1月28 | 中期评审 | 开发 + 测试 | 进度 100% |
| 2月4 | 测试评审 | 开发 + 测试 | 测试通过 |
| 2月9 | 发布评审 | 全体 | 发布准备 |

---

**预期成功率**: 95%  
**备用计划**: 如遇 1 周延误，可在 2 月 17 日前完成

